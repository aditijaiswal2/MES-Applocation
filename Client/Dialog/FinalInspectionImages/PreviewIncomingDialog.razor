 @using MES.Shared.Models.Rotors
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
@inject ISnackbar Snackbar
@using MES.Shared.DTOs
@using Newtonsoft.Json
@using System.Text
@inject HttpClient HttpClient
@inject IDialogService DialogService
@using MES.Client.Utitlity

@using System.Text.Json;

@using MES.Client.Dialog.QRPrint

<MudDialog MaxWidth="MaxWidth.ExtraLarge" FullWidth="true">
    <DialogContent>

        <MudPaper Class="pa-6" Style=" border-radius: 12px;" id="print-section">


            <MudGrid Spacing="3">

                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Serial Number</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.SerialNumber</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Module</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Module</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Sales Order</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.SalesOrderNumber</MudText>
                </MudItem>

            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Work Order</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.WorkOrder</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Mat#</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.MatNumber</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Customer</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Customer</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">


                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Location</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Location</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Received</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Received</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Inspected</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Inspected</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Rotors#</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.RotorsNumber</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Initials</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Initials</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Make</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Make</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Dia</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Dia</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Len</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Len</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Fits</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Fits</MudText>
                </MudItem>

            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Materials</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Materials</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Others</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Others</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Rotor Dia.</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.RotorsDia</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem xs="12" md="4" class="outlined-box">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Rotor Style</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.RotorStyle</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Type</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Type</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Bearing Removed</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.BearingRemoved</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Bearings</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Bearing</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Bearing Seals</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.BearingSeals</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Ceramic Seals</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.CeramicSeals</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Bearing Journal Dia (Right)</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.RotorsDiaRight</MudText>
                    <MudText Typo="Typo.body1">Bearing Journal Dia (Right Details): @InspectionData.yRight</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Bearing Journal Dia (Left)</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.RotorsDiaLeft</MudText>
                    <MudText Typo="Typo.body1">Bearing Journal Dia (Left Details): @InspectionData.yLeft</MudText>
                </MudItem>
                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Basic Sharpening</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.BasicSharpening</MudText>

                    <MudText Typo="Typo.h6" Color="Color.Primary">Basic Sharpening Detail</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.IfYBasicSharpening</MudText>

                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Wedgelock Alignment Marks Present</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.WedgelockAlignmentMarks</MudText>
                </MudItem>
                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Center Grinding</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.CenterGrinding</MudText>

                    <MudText Typo="Typo.h6" Color="Color.Primary">Center Grinding Details</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.IfYCenterGrinding</MudText>

                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Aligned</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Aligned</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">



                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Plastic Sleeves</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.PlasticSleaves</MudText>
                </MudItem>
                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Welding</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Welding</MudText>

                    <MudText Typo="Typo.h6" Color="Color.Primary">Welding Number</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.WeldingNum</MudText>

                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Bed Knife in Box</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.BedKnife</MudText>
                </MudItem>

            </MudGrid>

            <MudGrid Spacing="3">



                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Replace Blades</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.BoxReceivedWithSaddles</MudText>
                </MudItem>
                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Re-Profile</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.ReProfile</MudText>

                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Sand Blasting</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.SandBlasting</MudText>
                </MudItem>

            </MudGrid>

            <MudGrid Spacing="3">



                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Manual Labor</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.ManualLabor</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">TIR Left Journal</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.TirLeftJournal</MudText>

                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">TIR Right Journal</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.TirRightJournal</MudText>
                </MudItem>

            </MudGrid>



            <MudGrid Spacing="3">

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Box Received with Saddles (Down)</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Bottom</MudText>

                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Box Received with Saddles (Top)</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Top</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Add QTY</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.AddQty</MudText>
                </MudItem>

            </MudGrid>


            <MudGrid Spacing="3">

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Saddle Part Number</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.SaddlePartNumber</MudText>

                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Rotor Categorize  </MudText>
                    <MudText Typo="Typo.body1">@InspectionData.RotorCategorization</MudText>
                </MudItem>
                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">Component Type  </MudText>
                    <MudText Typo="Typo.body1">@InspectionData.ComponentType</MudText>
                </MudItem>

            </MudGrid>
            <MudItem xs="12" md="2" Class="d-flex justify-end">

            </MudItem>
        </MudPaper>

    </DialogContent>

    <DialogActions>
        @*  <MudButton OnClick="PrintDialog" Color="Color.Primary">Print</MudButton>
        *@ <MudButton OnClick="CloseDialog" Color="Color.Primary">Close</MudButton>
    </DialogActions>
</MudDialog>


<style>


    .outlined-box .mud-text {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }


    .outlined-box {
        border-radius: 8px;
        padding: 16px;
    }


    #print-section {
        background-color: #2a2a2a; /* Dark section background */
        padding: 14px;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.6);
        color: #ffffff; /* White text */
    }

</style>



@code {
    [Parameter]

    public RotorGrindingData InspectionData { get; set; }

    [CascadingParameter]
    MudDialogInstance MudDialog { get; set; }
    public QrDTO LocQR { get; set; }



    private List<(string label, string value)> GetInspectionFields()
    {
        return new List<(string, string)>
    {
        ("Sales Order", InspectionData.SalesOrderNumber),
        ("Work Order", InspectionData.WorkOrder),
        ("Mat#", InspectionData.MatNumber),
        ("Customer", InspectionData.Customer),
        ("Location", InspectionData.Location),
        ("Received", InspectionData.Received),
        ("Inspected", InspectionData.Inspected),
        ("Rotors#", InspectionData.RotorsNumber),
        ("Initial", InspectionData.Initials),
        ("Make", InspectionData.Make),
        ("Dia", InspectionData.Dia),
        ("Len", InspectionData.Len),
        ("Fits", InspectionData.Fits),
        ("Materials", InspectionData.Materials),
        ("Others", InspectionData.Others),
        ("Rotors Dia", InspectionData.RotorsDia),
        ("Rotors Style", InspectionData.RotorsDia),
        ("Type", InspectionData.Type),
        ("Bearing Removed", InspectionData.BearingRemoved),
        ("Bearings", InspectionData.Bearing),
        ("Bearing Seals",InspectionData.BearingSeals),
        ("Ceramic Seals", InspectionData.CeramicSeals),
        ("Bearing Journal Dia (Right)", InspectionData.Right),
        ("Bearing Journal Dia Details (Right)", InspectionData.yRight),
        ("Bearing Journal Dia (Left)", InspectionData.Left),
        ("Bearing Journal Dia Details (Left)", InspectionData.yLeft),
        ("Basic Sharpening", InspectionData.BasicSharpening),
        ("Basic Sharpening Details", InspectionData.IfYBasicSharpening),
        ("Wedgelock Alignment Marks; Present", InspectionData.WedgelockAlignmentMarks),
         ("Center Grinding", InspectionData.CenterGrinding),
        ("Center Grinding Details", InspectionData.IfYCenterGrinding),
        ("Aligned", InspectionData.Aligned),
        ("Plastic Sleaves", InspectionData.PlasticSleaves),
        ("Welding", InspectionData.Welding),
        ("No. of Welding", InspectionData.WeldingNum),
        ("Bed Knife in box", InspectionData.BedKnife),
        ("Replace Blades", InspectionData.BoxReceivedWithSaddles),
        ("Re-Profile", InspectionData.ReProfile),
        ("Sand Blasting", InspectionData.SandBlasting),
        ("Manual Labor", InspectionData.ManualLabor),
        ("Box Received with Saddles(Bottom)", InspectionData.Bottom),
        ("Box Received with Saddles(Top)", InspectionData.Top),
        ("Add QTY", InspectionData.AddQty?.ToString()),
        ("Saddle Part Number", InspectionData.SaddlePartNumber),
        ("Rotor Categorize", InspectionData.RotorCategorization),
          ("Component Type", InspectionData.ComponentType),

    };
    }

    private IEnumerable<List<(string label, string value)>> ChunkFields(List<(string label, string value)> fields, int size)
    {
        for (int i = 0; i < fields.Count; i += size)
        {
            yield return fields.Skip(i).Take(size).ToList();
        }
    }

    // async void PrintDialog()
    // {
    //     var receive = new QRRequestDTO
    //         {
    //             SerialNumber = SelectedSerialNumber,
    //             Module = SelectedModule,
    //             Customer = InspectionData.Customer,
    //             Date = DateTime.Now // or whatever date format you need
    //         };

    //     await GenerateQR(receive);
    //     //  await JSRuntime.InvokeVoidAsync("printDiv", "print-section");


    // }


    // public async Task GenerateQR(QRRequestDTO receive)
    // {
    //     Snackbar.Clear();
    //     Snackbar.Configuration.PositionClass = Defaults.Classes.Position.TopCenter;

    //     try
    //     {

    //         string receiveData = $"Serial Number: {receive.SerialNumber},Module: {receive.Module}, Customer: {receive.Customer}, Date: {receive.Date}";


    //         var jsonPart = JsonConvert.SerializeObject(receive);
    //         var content = new StringContent(jsonPart, Encoding.UTF8, "application/json");

    //         // Serialize receiving data



    //         //   var response = await HttpClient.PostAsync("https://localhost:7172/api/QRCode/IncomlocQR", content);
    //         var response = await HttpClient.PostAsync(ApiConstants.AddprintQRCode, content);
    //         byte[] qrCodeBytes = null;



    //         if (response.IsSuccessStatusCode)
    //         {
    //             using (var stream = await response.Content.ReadAsStreamAsync())
    //             using (var memoryStream = new MemoryStream())
    //             {
    //                 await stream.CopyToAsync(memoryStream);
    //                 qrCodeBytes = memoryStream.ToArray();
    //             }

    //             // Convert image to Base64 string
    //             string base64Image = Convert.ToBase64String(qrCodeBytes);
    //             string imageDataUrl = $"data:image/png;base64,{base64Image}";

    //             // Define the text to show under the QR code
    //             string labelText = $"SN: {receive.SerialNumber}";

    //             // Call JS function to print image
    //             await JSRuntime.InvokeVoidAsync("printincomingImage", imageDataUrl, labelText);
    //         }
    //         else
    //         {
    //             Snackbar.Add($"QR code generation failed with status code: {response.StatusCode}", Severity.Error);
    //         }
    //     }
    //     catch (Exception ex)
    //     {
    //         Snackbar.Add($"Error generating QR code: {ex.Message}", Severity.Error);
    //     }
    // }

    void CloseDialog()
    {
        MudDialog.Cancel();
    }




}
