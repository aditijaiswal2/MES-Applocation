﻿ @using MES.Shared.Models.Rotors
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
@inject ISnackbar Snackbar
@using MES.Shared.DTOs
@using Newtonsoft.Json
@using System.Text
@inject HttpClient HttpClient
@inject IDialogService DialogService

@using System.Text.Json;

@using MES.Client.Dialog.QRPrint

<MudDialog MaxWidth="MaxWidth.ExtraLarge" FullWidth="true">
    <DialogContent>
        <MudPaper Class="pa-6" Style=" border-radius: 12px;" id="print-section">

            <MudText Typo="Typo.h6" Class="mt-6 mb-2" Color="Color.Secondary">INCOMING ROTOR INSPECTION</MudText>

            <MudGrid Spacing="3">

                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Serial Number</MudText>
                    <MudText Typo="Typo.body1">@SelectedSerialNumber</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Module</MudText>
                    <MudText Typo="Typo.body1">@SelectedModule</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Sales Order</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.SalesOrderNumber</MudText>
                </MudItem>

            </MudGrid>

            <MudGrid Spacing="3">


                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Work Order</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.WorkOrder</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Mat#</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.MatNumber</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Customer</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Customer</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">


                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Location</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Location</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Received</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Received</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Inspected</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Inspected</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Rotors#</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.RotorsNumber</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Initials</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Initials</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Make</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Make</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Dia</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Dia</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Len</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Len</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Fits</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Fits</MudText>
                </MudItem>

            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Materials</MudText>
                    <MudText Typo="Typo.body1">@SelectedMaterial</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Others</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.Others</MudText>
                </MudItem>
                <MudItem md="4" xs="12" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Rotor Dia.</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.RotorsDia</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem xs="12" md="4" class="outlined-box">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Rotor Style</MudText>
                    <MudText Typo="Typo.body1">@SelectedRotorStyle</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Type</MudText>
                    <MudText Typo="Typo.body1">@SelectedType</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Bearing Removed</MudText>
                    <MudText Typo="Typo.body1">@Selectedberrem</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Bearings</MudText>
                    <MudText Typo="Typo.body1">@SelectedBearings</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Bearing Seals</MudText>
                    <MudText Typo="Typo.body1">@SelectedBearSeals</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Ceramic Seals</MudText>
                    <MudText Typo="Typo.body1">@SelectedCerSeals</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Bearing Journal Dia (Right)</MudText>
                    <MudText Typo="Typo.body1">@SelectedRL</MudText>
                    <MudText Typo="Typo.body1">Value: @InspectionData.yRight</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Bearing Journal Dia (Left)</MudText>
                    <MudText Typo="Typo.body1">@SelectedLR</MudText>
                    <MudText Typo="Typo.body1">Value: @InspectionData.yLeft</MudText>
                </MudItem>
                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Basic Sharpening</MudText>
                    <MudText Typo="Typo.body1">@Selectedbs</MudText>

                    @if (Selectedbs == "Yes")
                    {
                        <MudText Typo="Typo.subtitle2" Color="Color.Primary">Basic Sharpening Detail</MudText>
                        <MudText Typo="Typo.body1">@Selectedybasicsharp</MudText>
                    }
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">



                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Wedgelock Alignment Marks Present</MudText>
                    <MudText Typo="Typo.body1">@Selectedpre</MudText>
                </MudItem>
                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Center Grinding</MudText>
                    <MudText Typo="Typo.body1">@Selectedctr</MudText>

                    @if (Selectedctr == "Yes")
                    {
                        <MudText Typo="Typo.subtitle2" Color="Color.Primary">Center Grinding Details</MudText>
                        <MudText Typo="Typo.body1">@Selectedycg</MudText>
                    }
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Aligned</MudText>
                    <MudText Typo="Typo.body1">@Selectedalign</MudText>
                </MudItem>
            </MudGrid>

            <MudGrid Spacing="3">



                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Plastic Sleeves</MudText>
                    <MudText Typo="Typo.body1">@Selectedyps</MudText>
                </MudItem>
                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Welding</MudText>
                    <MudText Typo="Typo.body1">@Selectedwelding</MudText>

                    @if (Selectedwelding == "Yes")
                    {
                        <MudText Typo="Typo.subtitle2" Color="Color.Primary">Welding Number</MudText>
                        <MudText Typo="Typo.body1">@InspectionData.WeldingNum</MudText>
                    }
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Bed Knife in Box</MudText>
                    <MudText Typo="Typo.body1">@Selectebkid</MudText>
                </MudItem>

            </MudGrid>

            <MudGrid Spacing="3">



                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Replace Blades</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.BoxReceivedWithSaddles</MudText>
                </MudItem>
                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Re-Profile</MudText>
                    <MudText Typo="Typo.body1">@Selectedrp</MudText>

                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Sand Blasting</MudText>
                    <MudText Typo="Typo.body1">@Selectedsb</MudText>
                </MudItem>

            </MudGrid>

            <MudGrid Spacing="3">



                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Manual Labor</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.ManualLabor</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">TIR Left Journal</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.TirLeftJournal</MudText>

                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">TIR Right Journal</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.TirRightJournal</MudText>
                </MudItem>

            </MudGrid>



            <MudGrid Spacing="3">

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Box Received with Saddles (Down)</MudText>
                    <MudText Typo="Typo.body1">@Selectedbt</MudText>

                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Box Received with Saddles (Top)</MudText>
                    <MudText Typo="Typo.body1">@Selectedtb</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Add QTY</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.AddQty</MudText>
                </MudItem>

            </MudGrid>


            <MudGrid Spacing="3">

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Saddle Part Number</MudText>
                    <MudText Typo="Typo.body1">@InspectionData.SaddlePartNumber</MudText>

                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box pa-2">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Rotor Categorize  </MudText>
                    <MudText Typo="Typo.body1">@Selectedddrc</MudText>
                </MudItem>

                <MudItem xs="12" md="4" class="outlined-box">
                    <MudText Typo="Typo.subtitle2" Color="Color.Primary">Sub-Module</MudText>
                    <MudText Typo="Typo.body1">@Selecteddd</MudText>
                </MudItem>

            </MudGrid>
        </MudPaper>

    </DialogContent>

    <DialogActions>
        <MudButton OnClick="PrintDialog" Color="Color.Primary">Print</MudButton>
        <MudButton OnClick="CloseDialog" Color="Color.Primary">Close</MudButton>
    </DialogActions>
</MudDialog>


<style>
    /*  .outlined-box {
            border: 1px solid #444;
            border-radius: 8px;
            padding: 8px;


            margin-bottom: 8px;

            background-color: #1e1e1e;
            box-shadow: 0 2px 6px rgba(0,0,0,0.5);
            color: #f0f0f0;
        } */

    .outlined-box .mud-text {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }


    .outlined-box {
        border-radius: 8px;
        padding: 16px;
    }


    #print-section {
        background-color: #2a2a2a; /* Dark section background */
        padding: 24px;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.6);
        color: #ffffff; /* White text */
    }

</style>



@code {
    [Parameter]
    public IncomingInspection InspectionData { get; set; }

    [Parameter]
    public string SelectedMaterial { get; set; }
    [Parameter] public string SelectedType { get; set; }

    [Parameter] public string SelectedRotorStyle { get; set; }
    [Parameter] public string Selectedberrem { get; set; }
    [Parameter] public string SelectedBearings { get; set; }
    [Parameter] public string SelectedBearSeals { get; set; }
    [Parameter] public string SelectedCerSeals { get; set; }
    [Parameter] public string SelectedRL { get; set; }
    [Parameter] public string SelectedLR { get; set; }
    [Parameter] public string Selectedbs { get; set; }
    [Parameter] public string Selectedybasicsharp { get; set; }
    [Parameter] public string Selectedpre { get; set; }
    [Parameter] public string Selectedctr { get; set; }
    [Parameter] public string Selectedycg { get; set; }
    [Parameter] public string Selectedalign { get; set; }
    [Parameter] public string Selectedyps { get; set; }
    [Parameter] public string Selectedwelding { get; set; }
    [Parameter] public string Selectebkid { get; set; }
    [Parameter] public string Selectedrp { get; set; }
    [Parameter] public string Selectedsb { get; set; }
    [Parameter] public string Selectedbt { get; set; }
    [Parameter] public string Selectedtb { get; set; }
    [Parameter] public string Selectedddrc { get; set; }
    [Parameter] public string Selecteddd { get; set; }
    [Parameter] public string SelectedSerialNumber { get; set; }
    [Parameter] public string SelectedModule { get; set; }
    [CascadingParameter]
    MudDialogInstance MudDialog { get; set; }



    private List<(string label, string value)> GetInspectionFields()
    {
        return new List<(string, string)>
    {
        ("Sales Order", InspectionData.SalesOrderNumber),
        ("Work Order", InspectionData.WorkOrder),
        ("Mat#", InspectionData.MatNumber),
        ("Customer", InspectionData.Customer),
        ("Location", InspectionData.Location),
        ("Received", InspectionData.Received),
        ("Inspected", InspectionData.Inspected),
        ("Rotors#", InspectionData.RotorsNumber),
        ("Initial", InspectionData.Initials),
        ("Make", InspectionData.Make),
        ("Dia", InspectionData.Dia),
        ("Len", InspectionData.Len),
        ("Fits", InspectionData.Fits),
        ("Materials", SelectedMaterial),
        ("Others", InspectionData.Others),
        ("Rotors Dia", InspectionData.RotorsDia),
        ("Rotors Style", SelectedRotorStyle),
        ("Type", SelectedType),
        ("Bearing Removed", Selectedberrem),
        ("Bearings", SelectedBearings),
        ("Bearing Seals",SelectedBearSeals),
        ("Ceramic Seals", SelectedCerSeals),
        ("Bearing Journal Dia (Right)", SelectedRL),
        ("Bearing Journal Dia Details (Right)", InspectionData.yRight),
        ("Bearing Journal Dia (Left)", SelectedLR),
        ("Bearing Journal Dia Details (Left)", InspectionData.yLeft),
        ("Basic Sharpening", Selectedbs),
        ("Basic Sharpening Details", Selectedybasicsharp),
        ("Wedgelock Alignment Marks; Present", Selectedpre),
         ("Center Grinding", Selectedctr),
        ("Center Grinding Details", Selectedycg),
        ("Aligned", Selectedalign),
        ("Plastic Sleaves", Selectedyps),
        ("Welding", Selectedwelding),
        ("No. of Welding", InspectionData.WeldingNum),
        ("Bed Knife in box", Selectebkid),
        ("Replace Blades", InspectionData.BoxReceivedWithSaddles),
        ("Re-Profile", Selectedrp),
        ("Sand Blasting", Selectedsb),
        ("Manual Labor", InspectionData.ManualLabor),
        ("Box Received with Saddles(Bottom)", Selectedbt),
        ("Box Received with Saddles(Top)", Selectedtb),
        ("Add QTY", InspectionData.AddQty?.ToString()),
        ("Saddle Part Number", InspectionData.SaddlePartNumber),
        ("Rotor Categorize", Selectedddrc),
        ("Sub Module", Selecteddd),
    };
    }

    private IEnumerable<List<(string label, string value)>> ChunkFields(List<(string label, string value)> fields, int size)
    {
        for (int i = 0; i < fields.Count; i += size)
        {
            yield return fields.Skip(i).Take(size).ToList();
        }
    }

    async void PrintDialog()
    {

        //  await GenerateQR(SelectedSerialNumber, SelectedModule, InspectionData.Customer);
        await JSRuntime.InvokeVoidAsync("printDiv", "print-section");


    }

    void CloseDialog()
    {
        MudDialog.Cancel();
    }

    public class QRRequestDTO
    {
        public string SerialNumber { get; set; }
        public string Module { get; set; }
        public string Customer { get; set; }
        public DateTime Date { get; set; } = DateTime.Now;
    }

}